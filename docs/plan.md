# taskcast

现在大模型时代，llm流式、流式agent越来越多。而这个涉及到了一整套长周期任务追踪和管理。比如SSE流式推送。

但是，如果只是用单网页sse直接套用模型生成返回，刷新后就消失了，而且无法做到多网页对一追踪同一任务。

针对这种情况，我想做一个统一的服务，处理任务状态管理、追踪、查看、持久化等任务。

比如说，同一个sse接口，如果任务未开始（但是存在），可以挂起等待；如果任务正在进行中，可以直接订阅，默认返回之前的历史消息，但是也可以选择接收事件id/事件index/时间戳在某某之后的事件，可以有过滤规则（比如仅追踪、消息等级、wildcard类别、是否包含任务状态通知等，规律规则外还有是否包一层（带我们事件id的）），完成后自动断开回收资源；如果任务已失败、超时、完成等状态，可以直接返回最终结果或者错误信息，或者重放过程历史消息（根据追踪配置不同，默认重放）。

然后也可以有接口直接查询任务状态；有接口创建任务，改变任务状态，发送任务消息等；

消息有一个特殊的情况，同一block的流式消息的可以有一个系列id（比如stream同一段话、streamObject），可以在发消息时配置这个系列id的消息的规则是（全保留、累加（目前只支持纯文字累加）、取最新）

存储数据库有几层，可以分别抽象配置不同Provider：
1. 广播监听层：目前支持redis pub/sub
2. 短期存储层：目前支持redis，存放
3. 长期存储层：目前支持PostgreSQL/mongo/redis，存放长期任务历史记录

要求
1. pnpm monorepo
2. 文档友好，AI友好
3. 测试覆盖率高、考虑情况多、单元测试、边界测试、集成测试、并进行并发测试

